{% liquid
  assign product_media = product.selected_or_first_available_variant.featured_media | concat: product.media | uniq
%}

<div
  class='x-product-details-strip'
  data-product-pull-node='product-details-strip-{{ block.id }}-{{ product.id }}'
>
  <div class='product-details-items'>
    {% for media in product_media %}
      <div
        class='product-details-item'
        id='media-{{ forloop.index0 }}'
        data-hash-into-url
      >
        {% render 'x-media', media: media %}
      </div>
    {% endfor %}
  </div>
  <div
    class='product-details-indicators'
  >
    {% for media in product_media %}
      <a
        class='product-details-indicator'
        id='media-indicator-{{ forloop.index0 }}'
        href='#media-{{ forloop.index0 }}'
        data-dot-matrix
      >
        <style>
          :root:has(#media-{{ forloop.index0 }}[data-hash-into-url-active])
            #media-indicator-{{ forloop.index0 }} {
            mask-image: none;

            &::after {
              height: 100%;
            }
          }
        </style>
        {% render 'x-media', media: media %}
      </a>
    {% endfor %}
  </div>
</div>

{% stylesheet %}
  .x-product-details-strip {
    display: grid;
    grid-template-columns: 1fr auto;

    & .product-details-items {
      flex-grow: 1;

      padding-top: var(--x-header-height);

      display: grid;
      justify-items: center;

      & .product-details-item {
        position: relative;
        width: 100%;
        max-height: calc(100lvh - var(--x-header-height));

        &::after {
          content: '';
          position: absolute;
          right: 0;
          top: 0;
          height: 50%;
          border-right: 1px solid currentColor;
        }

        & * {
          width: 100%;
          height: 100%;
        }

        & img {
          object-fit: contain;
        }
      }
    }

    & .product-details-indicators {
      position: sticky;
      top: 0;
      height: 100lvh;

      padding-top: var(--x-header-height);

      display: grid;
      justify-items: center;
      gap: 0px;

      & .product-details-indicator {
        width: 100%;
        min-height: 0;

        position: relative;
        display: flex;

        color: currentColor;

        aspect-ratio: 2 / 3;
        max-width: 96px;

        &::after {
          content: '';
          position: absolute;
          right: 0;
          top: 0;
          height: 0;

          border-right: 1px solid currentColor;
          transition-property: height;
        }

        & * {
          width: 100%;
          height: 100%;
        }

        & img {
          object-fit: contain;
        }
      }
    }
  }
{% endstylesheet %}
