{% assign collection = block.settings.collection %}

<div
  class='x-shop-collection'
  data-intersection
>
  <a
    class='shop-collection-media'
    href='{{ collection.url }}'
  >
    <div class='shop-collection-thumbnail'>
      {{ collection.image | image_url: width: 2048 | image_tag }}
    </div>
    <div class='shop-collection-product-images'>
      {% assign product_images = collection.products | where: 'featured_media' | slice: 0, 3 | map: 'featured_media' %}
      {% for media in product_images %}
        <div class='shop-collection-product-image'>
          {% render 'x-media', media: media %}
        </div>
      {% endfor %}
    </div>
  </a>
  <div
    class='shop-collection-info'
  >
    <h3
      class='shop-collection-title h3'
      data-text-clip-reveal
      data-text-clip-reveal-per='character'
      data-text-clip-reveal-stagger-noise='0.2'
    >
      <a
        class='shop-collection-title-link'
        href='{{ collection.url }}'
      >
        {{ collection.title }}
      </a>
    </h3>
    <div class='shop-collection-content'>
      <div
        class='shop-collection-count h3'
        data-text-clip-reveal
        data-text-clip-reveal-per='character'
      >
        ({{ collection.products_count }})
      </div>
      <div class='shop-collection-tags'>
        {% for tag in collection.all_tags %}
          {% assign tag_handle = tag | handleize %}
          {% unless tag_handle == collection.handle or tag_handle == 'coming-soon' %}
            <span class='shop-collection-tag'>
              {% render 'x-product-tag-chip', tag: tag %}
            </span>
          {% endunless %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{% stylesheet %}
  .x-shop-collection {
    display: flex;
    flex-direction: column;
    gap: 16px;

    & .shop-collection-media {
      display: grid;
      gap: 16px;
      height: 300px;

      clip-path: inset(0 round 16px);

      transition-property: clip-path, translate;
      transition-duration: 1s;
      transition-timing-function: var(--ease-in-out);

      & {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr;
      }
      @media (width < 768px) {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 1fr;
      }

      & .shop-collection-thumbnail {
        border-radius: 16px;
        overflow: clip;
        height: 100%;
        min-height: 0;

        & img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
      }

      & .shop-collection-product-images {
        display: flex;
        height: 100%;
        min-height: 0;

        & img {
          width: 100%;
          height: 100%;
          object-fit: contain;
        }
      }
    }
    &:not([data-intersection-visible]) .shop-collection-media {
      clip-path: inset(0 0 100% 0 round 16px);
      transition-duration: 0s;
      transition-delay: 1s;
    }

    & .shop-collection-info {
      display: flex;
      gap: 16px;
      align-items: flex-start;

      overflow-x: clip;

      & .shop-collection-title {
        flex-grow: 1;
        margin: 0;

        font-weight: 500;

        transition-property: scale;
        transition-timing-function: var(--ease-in-out);
        transition-duration: 1s;

        transform-origin: bottom left;

        & .shop-collection-title-link {
          --color: currentColor;
        }
      }

      & .shop-collection-content {
        display: flex;
        gap: 16px;
        align-items: center;

        & .shop-collection-count {
          font-weight: 300;
        }

        & .shop-collection-tags {
          display: flex;
          gap: 4px;
          flex-wrap: wrap;
        }
      }
    }
    &:not([data-intersection-visible]) .shop-collection-info .shop-collection-title {
      scale: 4;
      transition-duration: 0s;
      transition-delay: 1s;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Shop: Collection",
  "tag": "slot",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Shop: Collection",
      "category": "Shop"
    }
  ]
}
{% endschema %}
